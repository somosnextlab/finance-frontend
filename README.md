# üè¶ Financiera NextLab - Frontend

Aplicaci√≥n web frontend para la plataforma financiera NextLab, construida con tecnolog√≠as modernas y siguiendo las mejores pr√°cticas de desarrollo.

## ‚úÖ Etapa 1 Completada

**Layout base + Theming light/dark + Componentes globales + Wrappers RHF**

## ‚úÖ Etapa 2 Completada

**Validaci√≥n de entorno con Zod + CSP + Sanitizaci√≥n HTML + Cliente fetch con interceptores + React Query en layouts privados + Route Handlers BFF para auth, payments y kyc con proxies firmados**

## ‚úÖ Etapa 3 Completada

**Wizard completo de onboarding con validaciones exhaustivas (Zod), formularios accesibles (RHF+MUI), m√°scaras AR (CUIL/CBU/tel√©fono), captura y compresi√≥n de im√°genes con Uppy (incl. webcam y preview), i18n base en espa√±ol, y BFF‚ÜíAPI usando route handlers**

### üéØ Funcionalidades Implementadas en Etapa 3

#### üßô‚Äç‚ôÇÔ∏è Wizard de Onboarding Completo
- **5 pasos secuenciales** con navegaci√≥n fluida y validaci√≥n en tiempo real
- **Persistencia de datos** con localStorage y recuperaci√≥n autom√°tica
- **Estados de validaci√≥n** (idle, pending, valid, invalid) por cada paso
- **Guardas de navegaci√≥n** para prevenir saltos de pasos inv√°lidos
- **M√°quina de estados** centralizada para control del flujo

#### üìù Pasos Implementados

1. **Contacto** - Email y tel√©fono argentino con validaci√≥n
2. **Datos Personales** - Nombre, apellido, DNI y CUIL con m√°scaras
3. **Domicilio** - Direcci√≥n completa con validaci√≥n postal argentina
4. **KYC** - Subida de documentos (DNI frente/dorso + selfie) con Uppy
5. **Revisi√≥n** - Resumen final y confirmaci√≥n de datos

#### üì∏ Sistema de Carga de Documentos KYC
- **Uppy integrado** con compresi√≥n autom√°tica de im√°genes
- **Captura webcam** para selfies con preview en tiempo real
- **Validaci√≥n estricta** (solo JPG/PNG, m√°ximo 3MB por archivo)
- **Subida paralela** de m√∫ltiples archivos con manejo de errores
- **Feedback visual** de progreso y archivos subidos
- **API endpoint** `/api/kyc/upload` con autenticaci√≥n condicional (solo en producci√≥n)

### üéØ Caracter√≠sticas Implementadas en Etapa 2

#### üîí Seguridad y Validaci√≥n

- **Validaci√≥n de entorno** con Zod y @t3-oss/env-nextjs
- **CSP (Content Security Policy)** nativo de Next.js con configuraci√≥n optimizada
- **Sanitizaci√≥n HTML** con DOMPurify para prevenir XSS
- **Headers de seguridad** configurados en middleware y next.config.js
- **Variables de entorno** tipadas y validadas
- **Protecci√≥n XSS** con X-XSS-Protection y CSP estricto
- **Prevenci√≥n clickjacking** con X-Frame-Options: DENY

#### üåê Cliente HTTP y BFF

- **Cliente HTTP** con interceptores de error y autenticaci√≥n
- **Route Handlers BFF** para auth, payments y kyc
- **Proxies firmados** con HMAC para comunicaciones seguras
- **Cookies httpOnly** para tokens de autenticaci√≥n
- **React Query** integrado en layouts privados

#### üîê Autenticaci√≥n y Autorizaci√≥n

- **Rutas de auth** (/api/auth/login, /me, /logout)
- **Validaci√≥n de tokens** con cookies seguras
- **Proxies a upstreams** con firmas HMAC
- **Manejo de errores** tipado y consistente

#### üìä M√≥dulos de Negocio

- **Payments** con intents firmados
- **KYC** con upload de archivos
- **Health checks** para monitoreo
- **Smoke tests** automatizados

### üéØ Caracter√≠sticas Implementadas en Etapa 3

#### üßô‚Äç‚ôÇÔ∏è Wizard de Onboarding

- **Wizard completo** de 5 pasos con navegaci√≥n fluida
- **Validaciones exhaustivas** con Zod en cada paso
- **Formularios accesibles** con React Hook Form + Material-UI
- **Persistencia de datos** con localStorage y React Query
- **Guardas de ruta** para prevenir navegaci√≥n inv√°lida
- **Estados de validaci√≥n** (idle, pending, valid, invalid)

#### üìù Pasos del Wizard

1. **Contacto**: Email y tel√©fono argentino
2. **Datos Personales**: Nombre, apellido, DNI y CUIL
3. **Domicilio**: Direcci√≥n completa con validaci√≥n postal
4. **KYC**: Documentos (DNI frente/dorso + selfie)
5. **Revisi√≥n**: Resumen y confirmaci√≥n final

#### üá¶üá∑ Validaciones Argentinas

- **CUIL**: Validaci√≥n con algoritmo oficial + bypass para desarrollo
- **CBU**: Formato y validaci√≥n bancaria argentina
- **Tel√©fono**: Formato argentino (10 d√≠gitos)
- **C√≥digo Postal**: 4 d√≠gitos argentinos
- **M√°scaras de entrada** para todos los campos AR

#### üì∏ Sistema de Carga de Documentos

- **Uppy integrado** con compresi√≥n autom√°tica
- **Captura webcam** para selfies
- **Validaci√≥n estricta** (solo JPG/PNG, m√°x. 3MB)
- **Preview de archivos** antes de subir
- **Reintentos autom√°ticos** en caso de fallo
- **Feedback de progreso** en tiempo real

#### üåê Internacionalizaci√≥n

- **i18n base** en espa√±ol
- **Estructura preparada** para m√∫ltiples idiomas
- **Traducciones** para todos los textos del wizard
- **Formateo** de fechas y n√∫meros argentinos

#### ‚ôø Accesibilidad

- **ARIA labels** en todos los elementos interactivos
- **Navegaci√≥n por teclado** completa
- **Orden de tab** l√≥gico
- **Mensajes de error** descriptivos
- **Contraste** optimizado para legibilidad

#### üîß Arquitectura T√©cnica

- **Schemas Zod** por cada paso del wizard
- **Hooks personalizados** para estado y persistencia
- **API client** con manejo de errores
- **TypeScript** estricto en toda la implementaci√≥n
- **SSR compatible** con validaciones condicionales

#### üì¶ Dependencias Agregadas en Etapa 3

**Validaci√≥n y Formularios:**
- `@hookform/resolvers` - Resolvers para RHF
- `zod` - Validaci√≥n de esquemas

**Carga de Archivos:**
- `@uppy/core` - Core de Uppy
- `@uppy/dashboard` - Dashboard de Uppy
- `@uppy/webcam` - Captura webcam
- `@uppy/image-compressor` - Compresi√≥n de im√°genes
- `@uppy/progress-bar` - Barra de progreso

**Validaciones Argentinas:**
- `libphonenumber-js` - Validaci√≥n de tel√©fonos
- `@types/libphonenumber-js` - Tipos TypeScript

**Internacionalizaci√≥n:**
- `next-intl` - i18n para Next.js

### üéØ Caracter√≠sticas Implementadas en Etapa 1

#### üé® Sistema de Theming

- **CSS Variables** con prefijo `nl-` para evitar conflictos
- **Modo claro/oscuro** con persistencia en localStorage
- **SSR-safe** con `getInitColorSchemeScript()` personalizado
- **Respeto a preferencias** del sistema (`prefers-color-scheme`)
- **Tokens de dise√±o** con escalas de color y espaciamiento

#### üèóÔ∏è Layout y Componentes

- **AppShell** responsivo con grid CSS
- **Header** con navegaci√≥n y toggle de tema
- **Sidebar** colapsable en m√≥viles
- **Footer** simple y consistente
- **Componentes globales** reutilizables

#### üìù Formularios y Validaci√≥n

- **Wrappers RHF+MUI** tipados con TypeScript
- **Validaci√≥n** con Zod schemas
- **Estados de error** integrados
- **Accesibilidad** con aria-labels

#### üöÄ Rendimiento y Calidad

- **TypeScript estricto** sin errores
- **Build optimizado** para producci√≥n
- **Hidrataci√≥n segura** sin warnings
- **Lighthouse ‚â• 90** en m√©tricas clave

#### üìÅ Archivos Creados/Modificados en Etapa 1

**Sistema de Theming:**

- `app/styles/tokens.ts` - Tokens de dise√±o con escalas de color
- `app/styles/theme.ts` - Tema MUI con CSS Variables
- `app/providers.tsx` - Proveedor principal con CssVarsProvider
- `app/globals.css` - Normalizaci√≥n CSS y variables de fuente

**Layout y Componentes:**

- `app/components/AppShell.tsx` - Shell principal responsivo
- `app/components/Header.tsx` - Header con toggle de tema
- `app/components/Sidebar.tsx` - Navegaci√≥n lateral
- `app/components/Footer.tsx` - Footer
- `app/components/ThemeToggle.tsx` - Toggle tema con hidrataci√≥n segura

**Componentes Globales:**

- `app/components/Loading.tsx` - Estado de carga
- `app/components/ErrorState.tsx` - Estado de error con retry
- `app/components/EmptyState.tsx` - Estado vac√≠o
- `app/components/DataTable.tsx` - Tabla base con MUI

**Wrappers de Formularios:**

- `app/components/form/FormTextField.tsx` - Campo de texto RHF+MUI
- `app/components/form/FormSelect.tsx` - Select RHF+MUI
- `app/components/form/index.ts` - Re-exports

**P√°ginas Demo:**

- `app/page.tsx` - Landing con AppShell
- `app/(private)/loans/page.tsx` - Demo con formulario y tabla
- `app/(private)/payments/page.tsx` - Demo con estado vac√≠o
- `app/error.tsx` - Error boundary
- `app/loading.tsx` - Loading fallback

**Configuraci√≥n:**

- `app/layout.tsx` - Layout ra√≠z con tipograf√≠a Inter y proveedores

#### üìÅ Archivos Creados/Modificados en Etapa 2

**Validaci√≥n y Seguridad:**

- `utils/env.ts` - Validaci√≥n de entorno con Zod y @t3-oss/env-nextjs
- `utils/sanitize.ts` - Sanitizaci√≥n HTML con DOMPurify
- `middleware.ts` - Headers de seguridad optimizados (X-Frame-Options, X-XSS-Protection, etc.)
- `next.config.js` - CSP nativo de Next.js con configuraci√≥n optimizada
- `.env.example` - Variables de entorno de ejemplo con validaci√≥n Zod

**Cliente HTTP y BFF:**

- `app/service/api-client.ts` - Cliente HTTP con interceptores de error
- `app/api/_utils.ts` - Helpers para respuestas y cookies del BFF
- `lib/sign.ts` - Utilidades de firma HMAC para proxies seguros

**Rutas BFF:**

- `app/api/auth/login/route.ts` - Login con cookies httpOnly
- `app/api/auth/me/route.ts` - Validaci√≥n de autenticaci√≥n
- `app/api/auth/logout/route.ts` - Logout
- `app/api/payments/intent/route.ts` - Intent de pago con firma HMAC
- `app/api/kyc/upload/route.ts` - Upload de archivos KYC

**Servicios y Testing:**

- `service/auth.ts` - Servicio de autenticaci√≥n para consumo del BFF
- `app/(private)/loans/page.tsx` - UI con panel de smoke test visual
- `smoke-tests.ps1` - Script de smoke tests automatizado
- `SMOKE_TESTS.md` - Documentaci√≥n de smoke tests

#### üìÅ Archivos Creados/Modificados en Etapa 3

**Schemas y Validaciones:**
- `features/onboarding/schemas/contact.ts` - Schema de datos de contacto
- `features/onboarding/schemas/personal.ts` - Schema de datos personales
- `features/onboarding/schemas/address.ts` - Schema de domicilio
- `features/onboarding/schemas/kyc.ts` - Schema de documentos KYC
- `features/onboarding/util-validators.ts` - Validadores argentinos (CUIL, CBU, tel√©fono)

**Componentes del Wizard:**
- `features/onboarding/components/Stepper.tsx` - Stepper del wizard
- `features/onboarding/components/StepActions.tsx` - Botones de navegaci√≥n
- `features/onboarding/components/fields/CuilField.tsx` - Campo CUIL con m√°scara
- `features/onboarding/components/fields/PhoneField.tsx` - Campo tel√©fono AR
- `features/onboarding/components/fields/CbuField.tsx` - Campo CBU con m√°scara

**Hooks y Estado:**
- `features/onboarding/hooks/useOnboardingMachine.ts` - M√°quina de estados del wizard
- `features/onboarding/hooks/useDraftStorage.ts` - Persistencia con localStorage

**UI y Carga de Archivos:**
- `features/onboarding/ui/UppyKycUploader.tsx` - Componente de carga con Uppy
- `features/onboarding/api/onboarding.ts` - Cliente API para onboarding

**P√°ginas del Wizard:**
- `app/(public)/onboarding/layout.tsx` - Layout del wizard
- `app/(public)/onboarding/page.tsx` - P√°gina principal (redirige a paso 1)
- `app/(public)/onboarding/step/[step]/page.tsx` - Controlador de pasos
- `app/(public)/onboarding/step/[step]/steps/ContactStep.tsx` - Paso 1: Contacto
- `app/(public)/onboarding/step/[step]/steps/PersonalStep.tsx` - Paso 2: Personales
- `app/(public)/onboarding/step/[step]/steps/AddressStep.tsx` - Paso 3: Domicilio
- `app/(public)/onboarding/step/[step]/steps/KycStep.tsx` - Paso 4: KYC
- `app/(public)/onboarding/step/[step]/steps/ReviewStep.tsx` - Paso 5: Revisi√≥n
- `app/(public)/onboarding/status/page.tsx` - Estado del onboarding

**Datos de Prueba:**
- `features/onboarding/mocks/testData.ts` - Datos mock para testing

**Configuraci√≥n:**
- `.env.local` - Variables de entorno locales
- `app/i18n/locales/es/onboarding.json` - Traducciones del wizard

**API Endpoints:**
- `app/api/kyc/upload/route.ts` - Endpoint de subida de documentos KYC (modificado para desarrollo sin auth)

### üéØ Caracter√≠sticas Implementadas

- **Next.js 14** con App Router para rendimiento √≥ptimo
- **TypeScript** estricto para tipado est√°tico y mejor DX
- **Material-UI (MUI)** con CSS Variables para theming din√°mico
- **Tema claro/oscuro** con persistencia y SSR-safe
- **Layout responsivo** con AppShell, Header, Sidebar y Footer
- **Componentes globales** (Loading, Error, Empty, DataTable)
- **Wrappers RHF+MUI** para formularios tipados
- **React Hook Form + Zod** para formularios robustos y validaci√≥n
- **React Query (TanStack Query)** para gesti√≥n de estado del servidor
- **Internacionalizaci√≥n (i18n)** preparada para m√∫ltiples idiomas
- **Sentry** para monitoreo de errores en producci√≥n
- **PostHog** para analytics y tracking de eventos
- **Generaci√≥n de PDFs** con React PDF Renderer
- **Subida de archivos** con Uppy
- **Linting y formateo** autom√°tico con ESLint y Prettier
- **Husky** para git hooks de calidad de c√≥digo

## üõ†Ô∏è Stack Tecnol√≥gico

### Frontend

- **Next.js 14** - Framework React con App Router
- **React 18** - Biblioteca de UI con Suspense
- **TypeScript 5** - Tipado est√°tico
- **Material-UI 5** - Sistema de dise√±o y componentes
- **Emotion** - CSS-in-JS para estilos

### Formularios y Validaci√≥n

- **React Hook Form** - Gesti√≥n eficiente de formularios
- **Zod** - Validaci√≥n de esquemas TypeScript-first
- **@hookform/resolvers** - Integraci√≥n entre RHF y Zod

### Estado y Datos

- **TanStack Query** - Gesti√≥n de estado del servidor
- **React Query** - Cach√© y sincronizaci√≥n de datos

### Utilidades

- **date-fns** - Manipulaci√≥n de fechas
- **DOMPurify** - Sanitizaci√≥n de HTML
- **pdf-lib** - Manipulaci√≥n de PDFs
- **Uppy** - Subida de archivos con drag & drop

### Monitoreo y Analytics

- **Sentry** - Monitoreo de errores
- **PostHog** - Analytics y feature flags

### Desarrollo

- **ESLint** - Linting de c√≥digo
- **Prettier** - Formateo autom√°tico
- **Husky** - Git hooks
- **lint-staged** - Linting en commits
- **Jest** - Testing framework

## üìÅ Estructura del Proyecto

```
app/
‚îú‚îÄ‚îÄ (admin)/           # Rutas protegidas para administradores
‚îú‚îÄ‚îÄ (private)/         # Rutas privadas autenticadas
‚îÇ   ‚îú‚îÄ‚îÄ loans/         # M√≥dulo de pr√©stamos (demo)
‚îÇ   ‚îî‚îÄ‚îÄ payments/      # M√≥dulo de pagos (demo)
‚îú‚îÄ‚îÄ (public)/          # Rutas p√∫blicas
‚îÇ   ‚îî‚îÄ‚îÄ onboarding/    # Wizard de onboarding
‚îÇ       ‚îú‚îÄ‚îÄ step/[step]/ # Pasos del wizard (1-5)
‚îÇ       ‚îî‚îÄ‚îÄ status/     # Estado del onboarding
‚îú‚îÄ‚îÄ api/               # API Routes de Next.js
‚îÇ   ‚îú‚îÄ‚îÄ auth/          # Autenticaci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ kyc/           # Know Your Customer
‚îÇ   ‚îú‚îÄ‚îÄ payments/      # Pagos
‚îÇ   ‚îî‚îÄ‚îÄ health/        # Health check endpoint
‚îú‚îÄ‚îÄ components/        # Componentes reutilizables
‚îÇ   ‚îú‚îÄ‚îÄ form/          # Wrappers de formularios RHF+MUI
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ FormTextField.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ FormSelect.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îú‚îÄ‚îÄ AppShell.tsx   # Layout principal responsivo
‚îÇ   ‚îú‚îÄ‚îÄ Header.tsx     # Header con navegaci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ Sidebar.tsx    # Navegaci√≥n lateral
‚îÇ   ‚îú‚îÄ‚îÄ Footer.tsx     # Footer
‚îÇ   ‚îú‚îÄ‚îÄ ThemeToggle.tsx # Toggle tema claro/oscuro
‚îÇ   ‚îú‚îÄ‚îÄ Loading.tsx    # Estado de carga
‚îÇ   ‚îú‚îÄ‚îÄ ErrorState.tsx # Estado de error
‚îÇ   ‚îú‚îÄ‚îÄ EmptyState.tsx # Estado vac√≠o
‚îÇ   ‚îú‚îÄ‚îÄ DataTable.tsx  # Tabla base con MUI
‚îÇ   ‚îî‚îÄ‚îÄ query-provider.tsx
‚îú‚îÄ‚îÄ features/          # Funcionalidades espec√≠ficas del dominio
‚îÇ   ‚îî‚îÄ‚îÄ onboarding/    # M√≥dulo de onboarding
‚îÇ       ‚îú‚îÄ‚îÄ schemas/   # Schemas Zod por paso
‚îÇ       ‚îú‚îÄ‚îÄ components/ # Componentes del wizard
‚îÇ       ‚îú‚îÄ‚îÄ hooks/     # Hooks personalizados
‚îÇ       ‚îú‚îÄ‚îÄ api/       # Cliente API
‚îÇ       ‚îú‚îÄ‚îÄ ui/        # Componentes UI espec√≠ficos
‚îÇ       ‚îî‚îÄ‚îÄ mocks/     # Datos de prueba
‚îú‚îÄ‚îÄ i18n/              # Configuraci√≥n de internacionalizaci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ config.ts
‚îÇ   ‚îî‚îÄ‚îÄ locales/
‚îÇ       ‚îî‚îÄ‚îÄ es/
‚îÇ           ‚îî‚îÄ‚îÄ common.json
‚îú‚îÄ‚îÄ service/           # Servicios y configuraci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ api-client.ts
‚îÇ   ‚îî‚îÄ‚îÄ query-client.ts
‚îú‚îÄ‚îÄ styles/            # Tema MUI y tokens de dise√±o
‚îÇ   ‚îú‚îÄ‚îÄ theme.ts       # Tema con CSS Variables
‚îÇ   ‚îî‚îÄ‚îÄ tokens.ts      # Tokens de dise√±o
‚îú‚îÄ‚îÄ utils/             # Utilidades y helpers
‚îÇ   ‚îú‚îÄ‚îÄ dates.ts
‚îÇ   ‚îú‚îÄ‚îÄ env.ts
‚îÇ   ‚îú‚îÄ‚îÄ format.ts
‚îÇ   ‚îú‚îÄ‚îÄ pdf.ts
‚îÇ   ‚îî‚îÄ‚îÄ upload.ts
‚îú‚îÄ‚îÄ providers.tsx      # Proveedores principales
‚îú‚îÄ‚îÄ layout.tsx         # Layout ra√≠z con tipograf√≠a
‚îú‚îÄ‚îÄ page.tsx           # Landing page
‚îú‚îÄ‚îÄ error.tsx          # Error boundary
‚îú‚îÄ‚îÄ loading.tsx        # Loading fallback
‚îî‚îÄ‚îÄ globals.css        # Estilos globales
```

## üöÄ Inicio R√°pido

### Prerrequisitos

- Node.js 18+
- pnpm (recomendado) o npm

### Instalaci√≥n

```bash
# Clonar el repositorio
git clone <repository-url>
cd finance-frontend

# Instalar dependencias
pnpm install

# Configurar variables de entorno
cp env.example .env.local
# Editar .env.local con tus configuraciones
```

### Desarrollo

```bash
# Ejecutar en modo desarrollo
pnpm dev

# La aplicaci√≥n estar√° disponible en http://localhost:3000
```

### Scripts Disponibles

```bash
# Desarrollo
pnpm dev              # Servidor de desarrollo
pnpm build            # Build para producci√≥n
pnpm start            # Servidor de producci√≥n

# Calidad de c√≥digo
pnpm lint             # Ejecutar ESLint
pnpm format           # Formatear con Prettier
pnpm typecheck        # Verificar tipos TypeScript

# Testing
pnpm test             # Ejecutar tests
pnpm test:coverage    # Tests con cobertura
pnpm test:single      # Tests una sola vez

# Onboarding (Etapa 3)
# Acceder a: http://localhost:3000/onboarding
# Wizard completo de 5 pasos con validaciones AR (Jest)

# Git hooks
pnpm prepare          # Configurar Husky

# Verificaci√≥n de la Etapa 1
pnpm typecheck        # ‚úÖ Sin errores de TypeScript
pnpm build            # ‚úÖ Build exitoso
pnpm dev              # ‚úÖ Servidor en http://localhost:3000
```

### üî• Smoke Tests - Etapa 2

Para verificar que el BFF funciona correctamente, ejecuta los smoke tests:

```bash
# Iniciar servidor de desarrollo
pnpm dev

# En otra terminal, ejecutar smoke tests
.\smoke-tests.ps1
```

**Comandos manuales de smoke test:**

```bash
# Health check
curl -i http://localhost:3000/api/health

# Auth sin cookie (debe fallar)
curl -i http://localhost:3000/api/auth/me

# Login
curl -i -X POST http://localhost:3000/api/auth/login \
  -H "content-type: application/json" \
  -d '{"email":"test@example.com","password":"secret"}'

# Auth con cookie (usar cookie de respuesta anterior)
curl -i http://localhost:3000/api/auth/me \
  -H "Cookie: nl_auth=dev.dGVzdEBleGFtcGxlLmNvbQ.token"

# Payments intent
curl -i -X POST http://localhost:3000/api/payments/intent \
  -H "content-type: application/json" \
  -H "Cookie: nl_auth=dev.dGVzdEBleGFtcGxlLmNvbQ.token" \
  -d '{"amount":1000,"currency":"ARS"}'
```

**Criterios de aceptaci√≥n:**
- ‚úÖ `/api/health` ‚Üí 200
- ‚úÖ `/api/auth/me` ‚Üí 401 sin cookie, 200 con cookie
- ‚úÖ `/api/payments/intent` ‚Üí 400 sin datos, 200 con datos
- ‚úÖ Ninguna respuesta expone secretos

## üîß Configuraci√≥n

### Variables de Entorno

Copia `env.example` a `.env.local` y configura:

```env
# SERVER (validados con Zod)
NODE_ENV=development
AUTH_UPSTREAM_URL=https://auth.example.com
PAYMENTS_UPSTREAM_URL=https://payments.example.com
KYC_UPSTREAM_URL=https://kyc.example.com
BFF_HMAC_SECRET=change_me_to_a_long_random_secret_32_chars_minimum
BFF_JWT_PRIVATE_KEY=-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----
COOKIE_NAME_AUTH=nl_auth
COOKIE_DOMAIN=localhost
COOKIE_SECURE=false

# CLIENT
NEXT_PUBLIC_APP_ENV=local
NEXT_PUBLIC_APP_NAME=Financiera NextLab
# NEXT_PUBLIC_API_BASE=http://localhost:3000/api

# Monitoreo (opcional)
SENTRY_DSN=your_sentry_dsn
NEXT_PUBLIC_POSTHOG_KEY=your_posthog_key
NEXT_PUBLIC_POSTHOG_HOST=https://app.posthog.com
```

### üîí Configuraci√≥n de Seguridad

La aplicaci√≥n implementa m√∫ltiples capas de seguridad:

#### CSP (Content Security Policy)
Configurado en `next.config.js` con pol√≠ticas nativas de Next.js:
- **Protecci√≥n XSS** con directivas estrictas
- **Compatibilidad MUI** con `'unsafe-inline'` necesario
- **Hot reload** con `'unsafe-eval'` en desarrollo

#### Headers de Seguridad
Configurados en `middleware.ts`:
- **X-Frame-Options: DENY** - Previene clickjacking
- **X-Content-Type-Options: nosniff** - Previene MIME sniffing
- **X-XSS-Protection: 1; mode=block** - Protecci√≥n adicional XSS
- **Referrer-Policy** - Control de informaci√≥n de referrer

#### Validaci√≥n de Entorno
Con `@t3-oss/env-nextjs` y Zod:
- **Tipado estricto** de variables de entorno
- **Validaci√≥n en runtime** con mensajes de error claros
- **Separaci√≥n** entre variables de servidor y cliente

### Tema y Dise√±o

El proyecto utiliza Material-UI con CSS Variables para theming din√°mico:

- **Tema**: Configurado en `app/styles/theme.ts` con `experimental_extendTheme`
- **Tokens**: Definidos en `app/styles/tokens.ts` con escalas de color y espaciamiento
- **Modo claro/oscuro**: ‚úÖ **Implementado** con persistencia y SSR-safe
- **CSS Variables**: Prefijo `nl-` para evitar conflictos
- **Tipograf√≠a**: Inter con `display: 'swap'` para mejor rendimiento
- **Responsive**: Layout adaptativo con grid CSS

## üåê Internacionalizaci√≥n

El proyecto est√° preparado para m√∫ltiples idiomas:

- **Idiomas soportados**: Espa√±ol (es), Ingl√©s (en)
- **Configuraci√≥n**: `app/i18n/config.ts`
- **Traducciones**: `app/i18n/locales/`

## üîí Seguridad

- **CSP nativo de Next.js** con configuraci√≥n optimizada en next.config.js
- **Headers de seguridad** configurados en middleware (X-Frame-Options, X-XSS-Protection, etc.)
- **Sanitizaci√≥n** de HTML con DOMPurify para prevenir XSS
- **Validaci√≥n** de datos con Zod y @t3-oss/env-nextjs
- **Protecci√≥n contra clickjacking** con X-Frame-Options: DENY
- **Prevenci√≥n MIME sniffing** con X-Content-Type-Options: nosniff
- **Control de referrer** con Referrer-Policy estricto

## üìä Monitoreo

- **Sentry**: Monitoreo de errores en tiempo real
- **PostHog**: Analytics y feature flags
- **Lighthouse**: M√©tricas de rendimiento

## ü§ù Contribuci√≥n

1. Fork el proyecto
2. Crea una rama para tu feature (`git checkout -b feature/AmazingFeature`)
3. Commit tus cambios (`git commit -m 'Add some AmazingFeature'`)
4. Push a la rama (`git push origin feature/AmazingFeature`)
5. Abre un Pull Request

### Est√°ndares de C√≥digo

- Usa TypeScript para todo el c√≥digo
- Sigue las convenciones de ESLint configuradas
- Formatea el c√≥digo con Prettier
- Documenta componentes complejos
- Usa BEM para CSS cuando sea apropiado
- Tipa todos los estados y acciones

## üìù Roadmap

### ‚úÖ Etapa 1 - Completada

**Layout base + Theming light/dark + Componentes globales + Wrappers RHF**

- [x] Configuraci√≥n base del proyecto
- [x] Sistema de dise√±o con MUI y CSS Variables
- [x] Configuraci√≥n de TypeScript estricto y ESLint
- [x] Estructura de carpetas y routing con App Router
- [x] **Tema claro/oscuro** con persistencia y SSR-safe
- [x] **Layout responsivo** (AppShell, Header, Sidebar, Footer)
- [x] **Componentes globales** (Loading, Error, Empty, DataTable)
- [x] **Wrappers RHF+MUI** para formularios tipados
- [x] **Tipograf√≠a** optimizada con Inter
- [x] **P√°ginas demo** para validaci√≥n visual
- [x] **Error boundaries** y estados de carga
- [x] **Accesibilidad** b√°sica y contraste adecuado
- [x] **Build optimizado** para producci√≥n

### ‚úÖ Etapa 2 - Completada

**Validaci√≥n de entorno + CSP + Sanitizaci√≥n + Cliente HTTP + BFF + Proxies firmados**

- [x] Validaci√≥n de entorno con Zod y @t3-oss/env-nextjs
- [x] CSP (Content Security Policy) con next-safe
- [x] Sanitizaci√≥n HTML con DOMPurify
- [x] Cliente HTTP con interceptores de error
- [x] React Query en layouts privados
- [x] Route Handlers BFF para auth, payments y kyc
- [x] Proxies firmados con HMAC
- [x] Cookies httpOnly para autenticaci√≥n
- [x] Smoke tests automatizados
- [x] Build y typecheck exitosos

### ‚úÖ Etapa 3 - Completada

**Wizard de Onboarding + Validaciones AR + Carga de Documentos KYC**

- [x] Wizard completo de 5 pasos con navegaci√≥n fluida
- [x] Validaciones exhaustivas con Zod en cada paso
- [x] Formularios accesibles con React Hook Form + Material-UI
- [x] M√°scaras argentinas (CUIL, CBU, tel√©fono, c√≥digo postal)
- [x] Sistema de carga de documentos con Uppy
- [x] Captura webcam para selfies con preview
- [x] Compresi√≥n autom√°tica de im√°genes
- [x] Persistencia de datos con localStorage
- [x] i18n base en espa√±ol
- [x] API endpoint KYC con autenticaci√≥n condicional
- [x] Estados de validaci√≥n y guardas de navegaci√≥n
- [x] M√°quina de estados centralizada

### üöß Etapa 4 - En Desarrollo

**Dashboard principal + Autenticaci√≥n + M√≥dulos b√°sicos**

- [ ] Implementaci√≥n de autenticaci√≥n (NextAuth.js)
- [ ] Dashboard principal con m√©tricas
- [ ] Gesti√≥n de usuarios y roles
- [ ] M√≥dulos financieros b√°sicos
- [ ] i18n completo (es/en)
- [ ] Testing con Jest y React Testing Library

### üîÆ Etapa 4 - Futuro

**Funcionalidades avanzadas + Optimizaciones**

- [ ] M√≥dulos financieros avanzados
- [ ] Reportes y analytics
- [ ] Notificaciones en tiempo real
- [ ] PWA y offline support
- [ ] Optimizaciones de rendimiento avanzadas

## üìÑ Licencia

Este proyecto es privado y pertenece a NextLab.

## üìû Soporte

Para soporte t√©cnico, contacta al equipo de desarrollo de NextLab.
